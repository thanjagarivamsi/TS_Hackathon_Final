/*
 * JS for mainPage generated by Appery.io
 */

Apperyio.getProjectGUID = function() {
    return 'eaae8fa4-076c-481a-82a7-0f5f72984b62';
};

function navigateTo(outcome, useAjax) {
    Apperyio.navigateTo(outcome, useAjax);
}

function adjustContentHeight() {
    Apperyio.adjustContentHeightWithPadding();
}

function adjustContentHeightWithPadding(_page) {
    Apperyio.adjustContentHeightWithPadding(_page);
}

function setDetailContent(pageUrl) {
    Apperyio.setDetailContent(pageUrl);
}

// Appery.io push registration service
var _pushRegistrationApperyService = new Apperyio.RestService({
    'url': 'https://api.appery.io/rest/push/reg',
    'dataType': 'json',
    'type': 'post',
    'contentType': 'application/json',
});

Apperyio.AppPages = [{
    "name": "mainPage",
    "location": "mainPage.html"
}, {
    "name": "CAN_Details",
    "location": "CAN_Details.html"
}, {
    "name": "CAN_Login",
    "location": "CAN_Login.html"
}, {
    "name": "distance",
    "location": "distance.html"
}, {
    "name": "Push_user",
    "location": "Push_user.html"
}];

function mainPage_js() {

    /* Object & array with components "name-to-id" mapping */
    var n2id_buf = {
        'mobilebutton_9': 'mainPage_mobilebutton_9',
        'mobileworkarea_7': 'mainPage_mobileworkarea_7',
        'spacer_14': 'mainPage_spacer_14',
        'mobileimage_12': 'mainPage_mobileimage_12',
        'spacer_13': 'mainPage_spacer_13',
        'mobilebutton_10': 'mainPage_mobilebutton_10',
        'spacer_15': 'mainPage_spacer_15',
        'mobilebutton_11': 'mainPage_mobilebutton_11',
        'spacer_16': 'mainPage_spacer_16',
        'spacer_11': 'mainPage_spacer_11',
        'mobileworkarea_10': 'mainPage_mobileworkarea_10',
        'spacer_17': 'mainPage_spacer_17',
        'mobilecarousel_18': 'mainPage_mobilecarousel_18',
        'mobilecarouselitem_19': 'mainPage_mobilecarouselitem_19',
        'mobilecarouselitem_20': 'mainPage_mobilecarouselitem_20',
        'mobilecarouselitem_21': 'mainPage_mobilecarouselitem_21',
        'mobileimage_3': 'mainPage_mobileimage_3',
        'spacer_4': 'mainPage_spacer_4',
        'mobilebutton_5': 'mainPage_mobilebutton_5',
        'mobilebutton_6': 'mainPage_mobilebutton_6',
        'mobilebutton_8': 'mainPage_mobilebutton_8'
    };

    if ("n2id" in window && window.n2id !== undefined) {
        $.extend(n2id, n2id_buf);
    } else {
        window.n2id = n2id_buf;
    }

    /*
     * Nonvisual components
     */

    Apperyio.mappings = Apperyio.mappings || {};

    Apperyio.datasources = Apperyio.datasources || {};

    /*
     * Appery.io Push-notification registration service
     */
    Apperyio.mappings["_pushRegistrationApperyService_onbeforesend"] = {
        "homeScreen": "mainPage",
        "directions": [{
            "from_name": "pushNotificationToken",
            "from_type": "LOCAL_STORAGE",
            "to_name": "_registerPushApperyDS",
            "to_type": "SERVICE_REQUEST",
            "mappings": [{
                "source": "$",
                "target": "$['body']['token']"
            }]
        }, {
            "from_name": "pushNotificationDeviceID",
            "from_type": "LOCAL_STORAGE",
            "to_name": "_registerPushApperyDS",
            "to_type": "SERVICE_REQUEST",
            "mappings": [{
                "source": "$",
                "target": "$['body']['deviceID']"
            }]
        }, {
            "from_name": "deviceTimeZone",
            "from_type": "LOCAL_STORAGE",
            "to_name": "_registerPushApperyDS",
            "to_type": "SERVICE_REQUEST",
            "mappings": [{
                "source": "$",
                "target": "$['body']['timeZone']"
            }]
        }, {
            "to_name": "_registerPushApperyDS",
            "to_type": "SERVICE_REQUEST",
            "mappings": [{
                "target_transformation": function(value) {
                    return Apperyio.getProjectGUID();
                },
                "target": "$['headers']['X-Appery-App-Id']"
            }, {
                "target_transformation": function(value) {
                    return Apperyio.getTargetPlatform();
                },
                "target": "$['body']['type']"
            }]
        }]
    };

    var _registerPushApperyDS = Apperyio.datasources._registerPushApperyDS = new Apperyio.DataSource(_pushRegistrationApperyService, {
        "onBeforeSend": function(jqXHR) {
            Apperyio.processMappingAction(Apperyio.mappings["_pushRegistrationApperyService_onbeforesend"]);
        },
        'onComplete': function(jqXHR, textStatus) {

        },
        'onSuccess': function(data) {
            console.info('App successfully registered with Appery.io Push service');
            $(document).trigger('pushregistrationsuccess');
        },
        'onError': function(jqXHR, textStatus, errorThrown) {
            $(document).trigger('pushregistrationfail');
        }
    });

    Apperyio.CurrentScreen = 'mainPage';
    _.chain(Apperyio.mappings).filter(function(m) {
        return m.homeScreen === Apperyio.CurrentScreen;
    }).each(Apperyio.UIHandler.hideTemplateComponents);

    /*
     * Events and handlers
     */

    // On Load
    var mainPage_onLoad = function() {
            mainPage_elementsExtraJS();

            mainPage_deviceEvents();
            mainPage_windowEvents();
            mainPage_elementsEvents();
        };

    // screen window events


    function mainPage_windowEvents() {

        $('#mainPage').bind('pageshow orientationchange', function() {
            var _page = this;
            adjustContentHeightWithPadding(_page);
        });

    };

    // device events


    function mainPage_deviceEvents() {
        document.addEventListener("deviceready", function() {

            var executePendingNotifications = function() {
                    PushNotification.getPendingNotifications(function(status) {
                        var notifications = status.notifications;
                        for (var i = 0; notifications && i < notifications.length; ++i) {
                            PushNotification.notificationCallback(notifications[i]);
                        }
                    });
                };
            executePendingNotifications();

            $(document).bind("resume", executePendingNotifications);

            $(document).bind("pushinit", function() {
                localStorage.setItem('pushNotificationToken', arguments[1].deviceToken);
                _registerPushApperyDS.execute({});
            });

            var pushNotification = PushNotification;
            pushNotification.getDeviceUniqueIdentifier(function(status) {
                localStorage.setItem('pushNotificationDeviceID', status);
            });

            var offset = new Date().getTimezoneOffset();
            var hr = parseInt(offset / (-60));
            var min = -offset - hr * 60;
            var tmin = '' + min;
            var timezone = 'UTC' + (hr > 0 ? '+' + hr : hr) + ':' + (tmin.length > 1 ? tmin : '0' + tmin);
            localStorage.setItem('deviceTimeZone', timezone);

            pushNotification.registerDevice({
                alert: true,
                badge: false,
                sound: true,
                senderid: ''
            }, function(status) {
                $(document).trigger('pushinit', status);
            });
        });
    };

    // screen elements extra js


    function mainPage_elementsExtraJS() {
        // screen (mainPage) extra code

        /* mobilecarousel_18*/
        var mobilecarousel_18_options = {
            indicatorsListClass: "ui-carousel-indicators",
            showIndicator: true,
            showTitle: true,
            titleBuildIn: false,
            titleIsText: true,
            animationDuration: 250,
            useLegacyAnimation: false,
            enabled: true,
        }
        Apperyio.__registerComponent('mobilecarousel_18', new Apperyio.ApperyMobileCarouselComponent("mainPage_mobilecarousel_18", mobilecarousel_18_options));

        $("#mainPage_mobilecarouselitem_19").attr("reRender", "mobilecarousel_18");

        $("#mainPage_mobilecarouselitem_20").attr("reRender", "mobilecarousel_18");

        $("#mainPage_mobilecarouselitem_21").attr("reRender", "mobilecarousel_18");

    };

    // screen elements handler


    function mainPage_elementsEvents() {
        $(document).on("click", "a :input,a a,a fieldset label", function(event) {
            event.stopPropagation();
        });

        $(document).off("click", '#mainPage_mobileheader [name="mobilebutton_9"]').on({
            click: function(event) {
                if (!$(this).attr('disabled')) {
                    $('[id="mainPage_panel_2"]').panel("open");

                }
            },
        }, '#mainPage_mobileheader [name="mobilebutton_9"]');

        $(document).off("click", '#mainPage_mobilecontainer [name="mobilebutton_10"]').on({
            click: function(event) {
                if (!$(this).attr('disabled')) {
                    Apperyio.navigateTo('CAN_Login', {
                        transition: 'slideup',
                        reverse: false
                    });

                }
            },
        }, '#mainPage_mobilecontainer [name="mobilebutton_10"]');

        $(document).off("click", '#mainPage_mobilecontainer [name="mobilebutton_11"]').on({
            click: function(event) {
                if (!$(this).attr('disabled')) {
                    Apperyio.navigateTo('distance', {
                        reverse: false
                    });

                }
            },
        }, '#mainPage_mobilecontainer [name="mobilebutton_11"]');

        $(document).off("click", '#mainPage_panel_2 [name="mobilebutton_5"]').on({
            click: function(event) {
                if (!$(this).attr('disabled')) {
                    Apperyio.navigateTo('mainPage', {
                        transition: 'pop',
                        reverse: false
                    });

                }
            },
        }, '#mainPage_panel_2 [name="mobilebutton_5"]');
        $(document).off("click", '#mainPage_panel_2 [name="mobilebutton_6"]').on({
            click: function(event) {
                if (!$(this).attr('disabled')) {
                    Apperyio.navigateTo('Push_user', {
                        transition: 'slidedown',
                        reverse: false
                    });

                }
            },
        }, '#mainPage_panel_2 [name="mobilebutton_6"]');
        $(document).off("click", '#mainPage_panel_2 [name="mobilebutton_8"]').on({
            click: function(event) {
                if (!$(this).attr('disabled')) {
                    Apperyio.navigateTo('distance', {
                        transition: 'flip',
                        reverse: false
                    });

                }
            },
        }, '#mainPage_panel_2 [name="mobilebutton_8"]');

    };

    $(document).off("pagebeforeshow", "#mainPage").on("pagebeforeshow", "#mainPage", function(event, ui) {
        Apperyio.CurrentScreen = "mainPage";
        _.chain(Apperyio.mappings).filter(function(m) {
            return m.homeScreen === Apperyio.CurrentScreen;
        }).each(Apperyio.UIHandler.hideTemplateComponents);
    });

    mainPage_onLoad();
};

$(document).off("pagecreate", "#mainPage").on("pagecreate", "#mainPage", function(event, ui) {
    Apperyio.processSelectMenu($(this));
    mainPage_js();
});